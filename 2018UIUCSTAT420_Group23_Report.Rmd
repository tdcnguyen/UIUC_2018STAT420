---
title: "UIUC, STAT 420, 2018 Summer, Group 23, Data Analysis Project Report, Assessing Developments in the Search for Another Earth"
author: "Jerome JASINSKI (jeromej2@illinois.edu), Dongrong LI (dl12@illinois.edu), Thai Duy Cuong NGUYEN (thaidn2@illinois.edu)"
date: '2018-08-03'
output:
html_document: 
toc: yes
pdf_document: default
urlcolor: cyan
---

## Introduction ##

Are we alone in the Universe? This is one of the most profound questions that humankind has sought to answer since the beginning of recorded history. We can gain some insight into this mystery with the modern search for exoplanets. The underlying purpose of contemporary exoplanet programs is to discover habitable planets, especially around nearby stars, and find evidence of life elsewhere in the cosmos. Using Earth and its lifeforms as a template to assess habitability, we seek other celestial bodies with conditions similar to our own, i.e., with Earth-like surface gravities and temperatures where liquid water could exist. In order to meet these criteria, most habitable worlds must be a particular mass and a particular distance from their host star. We are interested in analyzing the data for confirmed exoplanets to asses our progress in finding a planet with similar physical characteristics to Earth.

For our investigation, we used data from the NASA Exoplanet Archive, which can be found at the following URL [https://exoplanetarchive.ipac.caltech.edu](https://exoplanetarchive.ipac.caltech.edu). This archive is an online compilation, collation, and cross-correlation of astronomical data and information on exoplanets and their host stars. The data are vetted by a team of astronomers at the California Institute of Technology (Caltech) under contract with the National Aeronautics and Space Administration (NASA) under the Exoplanet Exploration Program. An extensive overview of the data, services and tools of the archive can be found in a published paper by Akeson, et al. (2013, PASP, 125, 989) in the Publications of the Astronomical Society of the Pacific (PASP). This publication can be found [here](http://adsabs.harvard.edu/abs/2013PASP..125..989A).

We downloaded our dataset from the NASA Exoplanet Archive on 2018 July 5. The data consists of 354 columns and 3,748 rows of information on confirmed exoplanets and their host stars as well as information about their discovery. Discovery information includes the method used to detect the exoplanet, the locale of the observatories used for detection (i.e., whether ground-based, space-based, or a mixture of both observations were used for detection), and the year of discovery. Physical characteristics of exoplanets present in the archive include planetary mass, orbital period, and orbital semi-major axis. Physical properties of host stars listed in the archive include stellar mass, stellar radius, effective temperature, surface gravity, spectral type, luminosity, and distance from Earth. These physical properties for both exoplanets and their host stars are important for determining the similarity between an exoplanet and Earth, and their detection sensitivity.

We trimmed and removed space characters from the original dataset from the NASA Exoplanet Archive to the 15 columns that are most relevant and directly related to habitable planets. These data are stored in the file `planets.csv`. The variables for which we are interested as responses are `pl_bmasse`, `pl_orbsmax` and `st_dist` are the planet mass in Earth masses ($R_\odot = 5.9722 \times 10^{24}\,\rm{kg}$), the planet orbital semi-major axis in astronomical units ($\rm{AU} = 1.495978707 \times 10^{11}\,\rm{m}$), and the distance from our solar system to the exoplanet system in parsecs ($\rm{pc} = 3.0857 \times 10^{16}\,\rm{m}$). These response variables are key physical parameters that determine the habitability of a planet and the potential feasibility of reaching such a planet.

## Methods ##

### Data preprocessing ###

To ensure we had a consistent dataset with no empty values for any responses or predictors for which we were considering, we filtered out rows with any empty values and were left with 594 rows.

```{r}
planets <- read.csv("planets.csv")
planets_good <- planets[complete.cases(planets), ]
```

The structure of the `R` object for which we will perform our analysis is as follows.

```{r}
str(planets_good)
```

There are two factor variables and 13 numeric variables. The following table briefly describes the variables.

```{r, echo = FALSE}
var_table <- data.frame(variable_names = c("`pl_discmethod`",
                                           "`pl_disc`",
                                           "`pl_locale`",
                                           "`st_dist`",
                                           "`st_optmag`",
                                           "`st_teff`",
                                           "`st_mass`",
                                           "`st_rad`",
                                           "`st_logg`",
                                           "`st_metfe`",
                                           "`st_vsini`",
                                           "`pl_orbper`",
                                           "`pl_orbsmax`",
                                           "`pl_orbeccen`",
                                           "`pl_bmasse`"),
                        variable_descriptions = c("Method of discovery (RadialVelocity, Transit, TransitTimingVariations, etc.)",
                                                  "Year of discovery",
                                                  "Locale of discovery (Ground, MultipleLocales or Space)",
                                                  "Stellar distance (parsecs)",
                                                  "Stellar apparent magnitude (mag)",
                                                  "Stellar effective temperature (Kelvin)",
                                                  "Stellar mass (solar masses)",
                                                  "Stellar radius (solar radii)",
                                                  "Stellar surface gravity (log g)",
                                                  "Stellar metallicity (log(Fe/H or M/H))",
                                                  "Stellar projected rotational velocity (m/s)",
                                                  "Planet orbital period (days)",
                                                  "Planet orbital semi-major axis (AU)",
                                                  "Planet orbital eccentricity",
                                                  "Planet mass (Earth masses)")
)
knitr::kable(var_table,
             "markdown",
             row.names = FALSE,
             col.names = c("Variable name", "Variable description"),
             align = c('l', 'l'))
```

Some of these variables may be collinear to each other. We can inspect for collinearity visually using a matrix of scatterplots of the variables.

```{r, echo = FALSE, fig.height=24, fig.width=24}
pairs(planets_good, col = "dodgerblue")
```

From the matrix of scatterplots, it appears that planet orbital period (`pl_orbper`) and orbital semi-major axis (`pl_orbsmax`) are collinear. This collinearity is not unexpected since orbital period and semi-major axis are related to each other physically as supported in Kepler's third law of planetary motion. It also appears that stellar radius (`st_rad`) and stellar surface gravity (`st_logg`) are collinear as well. Collinearity makes estimating model coefficients and interpreting models more difficult, but it does not affect model predictions. We will keep this in mind as we search for potential models for our data.

### Model search ###

The response for which we are most interested for the study exoplanet habitability is planet orbital semi-major axis (`pl_orbsmax`). The planet orbital semi-major axis is essentially the distance between a planet and its host star. This distance is important to planet habitability because only a certain range of distances between a planet and its host star would allow liquid water to exist on the planet to support life as we know it.

We will first begin with an additive model with `pl_orbsmax` as the response and the remaining variables as predictors except `pl_orbper` which is fairly collinear with the response.

```{r}
pl_orbsmax_mod_add <- lm(pl_orbsmax ~ . - pl_orbper, data = planets_good)
summary(pl_orbsmax_mod_add)
```

From the high *p-values* from the *t-statistic* for some of the predictors, a simpler model may be preferred.

We will use a backward BIC search to find a potentially better model.

```{r}
n <- length(resid(pl_orbsmax_mod_add))
pl_orbsmax_mod_back_bic <- step(pl_orbsmax_mod_add, direction = "backward", k = log(n), trace = 0)
summary(pl_orbsmax_mod_back_bic)
```

The model found by a backward BIC search is considerably simpler; this model has seven parameters compared to 14 for the additive model. Furthermore, most of the predictors have low *p-values* associated with their *t-statistic*. However, the adjusted $R^2$ of `r summary(pl_orbsmax_mod_back_bic)$adj.r.squared` could be improved.

Next, we will try transform the response `pl_orbsmax`. Physically, the span of exoplanet orbital semi-major axis is fairly large. Thus, we are motivated to transform the response with a logarithm function and repeat the previous model search.

```{r}
log_pl_orbsmax_mod_add <- lm(log(pl_orbsmax) ~ . - pl_orbper, data = planets_good)
n <- length(resid(log_pl_orbsmax_mod_add))
log_pl_orbsmax_mod_back_bic <- step(log_pl_orbsmax_mod_add, direction = "backward", k = log(n), trace = 0)
summary(log_pl_orbsmax_mod_back_bic)
```

For this `log(pl_orbsmax)` model, the adjusted $R^2$ of `r summary(log_pl_orbsmax_mod_back_bic)$adj.r.squared` is an improvement from the analogous model for `pl_orbsmax`. We could consider interaction models, but with nine parameters in this latest model already, we will forego deriving an interaction model for now.

### Residual diagnostics ###




```{r}
n <- (2^8) * (3^5)
loocv_rmse_results <- rep(0, n)
adj_r2_results <- rep(0, n)
bp_value_results <- rep(0, n)
sw_value_results <- rep(0, n)
num_params_results <- rep(0, n)
```

```{r, eval = FALSE}
lm_str_head <- "m=lm(log(pl_orbsmax)~"
lm_str_tail <- ",data=p)"
lm_str <- rep("", n)
i <- 1
for (ipl_discmethod in c("1", "pl_discmethod")) {
  for (ipl_disc in c("1", "pl_disc")) {
    for (ipl_locale in c("1", "pl_locale")) {
      for (ist_dist in c("1", "st_dist", "log(st_dist)")) {
        for (ist_optmag in c("1", "st_optmag")) {
          for (ist_teff in c("1", "st_teff", "log(st_teff)")) {
            for (ist_mass in c("1", "st_mass", "log(st_mass)")) {
              for (ist_rad in c("1", "st_rad", "log(st_rad)")) {
                for (ist_logg in c("1", "st_logg")) {
                  for (ist_metfe in c("1", "st_metfe")) {
                    for (ist_vsini in c("1", "st_vsini")) {
                      for (ipl_orbeccen in c("1", "pl_orbeccen")) {
                        for (ipl_bmasse in c("1", "pl_bmasse", "log(pl_bmasse)")) {
                          lm_str[i] <- paste(ipl_discmethod,
                                             ipl_disc,
                                             ipl_locale,
                                             ist_dist,
                                             ist_optmag,
                                             ist_teff,
                                             ist_mass,
                                             ist_rad,
                                             ist_logg,
                                             ist_metfe,
                                             ist_vsini,
                                             ipl_orbeccen,
                                             ipl_bmasse,
                                             sep = "+")
                          i <- i + 1
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
```

```{r, eval = FALSE}
for (i in 2:n) {
  if ( 0 == i %% 10000) {
    print(i)
  }
  
  eval(parse(text = paste(lm_str_head, lm_str[i], lm_str_tail)))
  
  loocv_rmse_results[i] <- get_loocv_rmse(m)
  adj_r2_results[i] <- get_adj_r2(m)
  bp_value_results[i] <- bptest(m)$p.value
  sw_value_results[i] <- shapiro.test(resid(m))$p.value
  num_params_results[i] <- get_num_params(m)
}
```

## Results ##

## Discussion ##

## Appendix ##

```{r}
library(lmtest)

get_bp_decision = function(model, alpha) {
  decide = unname(bptest(model)$p.value < alpha)
  ifelse(decide, "Reject", "Fail to Reject")
}

get_sw_decision = function(model, alpha) {
  decide = unname(shapiro.test(resid(model))$p.value < alpha)
  ifelse(decide, "Reject", "Fail to Reject")
}

get_num_params = function(model) {
  length(coef(model))
}

get_loocv_rmse = function(model) {
  sqrt(mean((resid(model) / (1 - hatvalues(model))) ^ 2))
}

get_adj_r2 = function(model) {
  summary(model)$adj.r.squared
}
```
